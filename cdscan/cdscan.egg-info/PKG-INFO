Metadata-Version: 2.4
Name: cdscan
Version: 0.1.0
Summary: Multi-tool code review using tree-sitter, ctags, and ripgrep for comprehensive codebase analysis
Author: Developer
Requires-Python: >=3.8
Description-Content-Type: text/markdown
Requires-Dist: tree-sitter>=0.20.0
Requires-Dist: tree-sitter-python>=0.20.0
Provides-Extra: dev
Requires-Dist: pytest>=7.0.0; extra == "dev"
Requires-Dist: black>=23.0.0; extra == "dev"

# Cdscan Skill

Multi-tool code review using tree-sitter, ctags, and ripgrep for comprehensive codebase analysis.

## New Features ✨

- **C++ Support**: Full AST parsing for C++ (classes, functions, methods, includes)
- **AST-based Import Parsing**: Accurate import graphs extracted from AST instead of regex
- **Configurable Limits**: Control output size with `--max-files`, `--max-hotspots`, `--max-apis`, `--max-search-results`

## Quick Start

```bash
# Basic usage
cd /home/vscode/.claude/skills/cdscan
python run_code_review.py --workspace /path/to/project

# Python codebase
python run_code_review.py --workspace /path/to/project --pattern "**/*.py"

# C++ codebase with limits
python run_code_review.py \
  --workspace /path/to/cpp-project \
  --pattern "**/*.{cpp,hpp,h}" \
  --language cpp \
  --max-files 30 \
  --max-hotspots 10

# JavaScript/TypeScript with verbose output
python run_code_review.py \
  --workspace /path/to/webapp \
  --pattern "**/*.{js,ts}" \
  --language javascript \
  --verbose
```

## What It Does

1. **Tree-sitter Analysis** - Parse syntax trees, extract functions/classes, identify complexity, build import graphs from AST
2. **Ctags Indexing** - Generate symbol index, categorize public APIs vs internal functions
3. **Ripgrep Search** - Find tests, error patterns, TODOs, security issues
4. **Synthesis** - Combine findings into actionable insights

## Output

Generates `codebase_structure.toon` in **TOON format** (Token-Oriented Object Notation) with:
- Codebase summary (files, functions, classes)
- Structure analysis (modules, design patterns)
- Definition index (public APIs, internal functions)
- Pattern findings (tests, errors, technical debt, **import graph with AST source**)
- Code quality metrics (complexity, security)
- Recommendations (refactoring, improvements)
- Integration points (databases, APIs, frameworks)

**TOON format** uses ~40% fewer tokens than JSON, optimized for LLM consumption.

## Command Options

```
--workspace <dir>          # Project directory (required)
--pattern <glob>           # File glob pattern (default: **/*.py)
--language <lang>          # Primary language: python, javascript, cpp, etc.
--output <file>            # Output file path (default: codebase_structure.toon)
--verbose                  # Enable detailed logging
--max-files <N>            # Max files in results (default: 20)
--max-hotspots <N>         # Max complexity hotspots (default: 15)
--max-apis <N>             # Max public APIs to list (default: 20)
--max-search-results <N>   # Max search results per pattern (default: 100)
```

## Prerequisites

### Required Tools

**1. Tree-sitter** (syntax parsing)
```bash
pip install tree-sitter tree-sitter-python tree-sitter-javascript tree-sitter-cpp tree-sitter-typescript
```

**2. Ctags** (symbol indexing)
```bash
# macOS
brew install ctags

# Ubuntu/Debian
apt-get install exuberant-ctags

# Verify
ctags --version
```

**3. Ripgrep** (fast search)
```bash
# macOS
brew install ripgrep

# Ubuntu/Debian
apt-get install ripgrep

# Verify
rg --version
```

### Language Parsers

```bash
# Python
pip install tree-sitter-python

# JavaScript/TypeScript
pip install tree-sitter-javascript tree-sitter-typescript

# C++ (Full AST support for classes, functions, includes)
pip install tree-sitter-cpp

# Verify all parsers
python -c "import tree_sitter_python, tree_sitter_cpp, tree_sitter_javascript; print('All parsers installed')"
```

**Note**: Modern tree-sitter (v0.25+) uses a simplified API:
```python
import tree_sitter_python as tspython
from tree_sitter import Language, Parser

PY_LANGUAGE = Language(tspython.language())
parser = Parser(PY_LANGUAGE)
tree = parser.parse(bytes(code, "utf8"))
```

## Example Workflows

### Python Project Analysis
```bash
python run_code_review.py \
  --workspace /workspaces/myapp \
  --pattern "**/*.py" \
  --max-files 25
```

### C++ Security Audit
```bash
python run_code_review.py \
  --workspace /workspaces/cpp-project \
  --pattern "**/*.{cpp,hpp,h,cc,cxx}" \
  --language cpp \
  --output security_audit.toon

# Review the TOON output
cat security_audit.toon
```

### JavaScript Codebase Overview
```bash
python run_code_review.py \
  --workspace /workspaces/webapp \
  --pattern "**/*.{js,ts}" \
  --language javascript

# Review the structured output
cat codebase_structure.toon
```

### Focused Module Analysis
```bash
# Analyze only authentication module
python run_code_review.py \
  --workspace /workspaces/platform \
  --pattern "src/auth/**/*.py" \
  --output auth_analysis.toon

# Review findings
cat auth_analysis.toon
```

## Best Practices

### Performance Optimization

**Use specific patterns** - Narrow scope with globs
```bash
--pattern "src/**/*.py"           # Only src directory
--pattern "**/*.{js,ts}"          # Multiple extensions
--pattern "**/*.{cpp,hpp,h}"      # C++ files
```

**Configure limits** - Adjust for large codebases
```bash
python run_code_review.py \
  --workspace /workspaces/large-project \
  --max-files 10 \
  --max-hotspots 5 \
  --max-apis 15 \
  --max-search-results 50
```

**Cache results** - Reuse existing analysis
```bash
# Only re-run if significant changes
if [[ $(git diff --name-only HEAD~1 | wc -l) -gt 10 ]]; then
  python run_code_review.py --workspace .
fi
```

## Troubleshooting

### Tree-sitter parser not found
```bash
# Error: "Parser for Python not found"
pip install tree-sitter-python tree-sitter-cpp

# Verify installation (modern API)
python -c "import tree_sitter_python as tspython; from tree_sitter import Language, Parser; lang = Language(tspython.language()); parser = Parser(lang); print('OK')"
```

### Tree-sitter API errors
```bash
# Error: "language must be assigned a tree_sitter.Language object"
# You're using old API. Update to modern API (v0.25+):

# ❌ Old (deprecated)
# parser.set_language(language())

# ✅ New (v0.25+)
from tree_sitter import Language, Parser
import tree_sitter_python as tspython
PY_LANGUAGE = Language(tspython.language())
parser = Parser(PY_LANGUAGE)
```

### Ctags not generating tags
```bash
# Ensure it's exuberant-ctags or universal-ctags, not BSD ctags
which ctags
ctags --version  # Should be "Exuberant Ctags" or "Universal Ctags"

# macOS: Replace BSD ctags
brew install ctags
```

### Ripgrep search too slow
```bash
# Use file type filters
rg --type py "pattern"  # Faster than **/*.py

# Exclude large directories
rg "pattern" --glob '!node_modules' --glob '!.venv' --glob '!build'
```

## Tool Structure

```
cdscan/
├── SKILL.md                      # Complete skill documentation
├── README.md                     # This quick start guide
├── run_code_review.py            # Main entry point
└── tools/
    ├── treesitter_analyzer.py    # AST parsing and import graphs
    ├── ctags_indexer.py          # Symbol indexing
    ├── ripgrep_searcher.py       # Pattern search
    └── toon_serializer.py        # TOON format output
```

## See Also

- [SKILL.md](SKILL.md) - Complete skill documentation
- [Tree-sitter Documentation](https://tree-sitter.github.io/tree-sitter/)
- [Ctags Documentation](https://ctags.io/)
- [Ripgrep Documentation](https://github.com/BurntSushi/ripgrep)
